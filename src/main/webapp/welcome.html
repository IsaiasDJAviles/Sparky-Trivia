<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="sparky_logo.png">
    <title>Bienvenido a Sparky Trivia</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <!-- Animaciones -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="css/styles.css">

    <style>
        /* Hero Section */
        .hero-section {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            padding: 80px 20px 60px;
        }

        .welcome-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .welcome-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .welcome-logo img {
            width: 45px;
            height: 45px;
            transition: transform 0.3s ease;
        }

        .welcome-logo:hover img {
            transform: rotate(10deg) scale(1.1);
        }

        .welcome-logo h1 {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--color-azul-claro), var(--color-morado));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
        }

        .header-buttons {
            display: flex;
            gap: 15px;
        }

        .login-button {
            background: linear-gradient(135deg, var(--color-azul-claro), var(--color-morado));
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .dashboard-button {
            background: linear-gradient(135deg, var(--color-verde), #4caf50);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(107, 207, 127, 0.3);
        }

        .dashboard-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(107, 207, 127, 0.4);
        }

        /* Contenido Hero */
        .hero-content {
            max-width: 1200px;
            width: 100%;
            text-align: center;
        }

        .hero-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 3.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--color-azul-claro), var(--color-morado));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .hero-subtitle {
            font-size: 1.3rem;
            color: var(--color-gris);
            margin-bottom: 40px;
            font-weight: 400;
        }

        .sparky-hero {
            width: 300px;
            height: 300px;
            margin: 30px auto;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        /* Features Grid */
        .features-section {
            padding: 80px 20px;
            background: linear-gradient(180deg, transparent 0%, rgba(102, 126, 234, 0.05) 100%);
        }

        .features-grid {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
        }

        .feature-card {
            background: white;
            padding: 40px 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            text-align: center;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.2);
        }

        .feature-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, var(--color-azul-claro), var(--color-morado));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
        }

        .feature-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--color-azul-oscuro);
            margin-bottom: 15px;
        }

        .feature-description {
            color: var(--color-gris);
            font-size: 1rem;
            line-height: 1.6;
        }

        /* CTA Section */
        .cta-section {
            padding: 80px 20px;
            background: linear-gradient(135deg, var(--color-azul-claro), var(--color-morado));
            text-align: center;
        }

        .cta-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .cta-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 20px;
        }

        .cta-description {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 40px;
        }

        .cta-button {
            background: white;
            color: var(--color-azul-claro);
            border: none;
            padding: 18px 50px;
            border-radius: 30px;
            font-weight: 700;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        /* Footer */
        .footer {
            background: var(--color-azul-oscuro);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }

        .footer-text {
            margin: 0;
            opacity: 0.9;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }

            .hero-subtitle {
                font-size: 1.1rem;
            }

            .sparky-hero {
                width: 200px;
                height: 200px;
            }

            .welcome-logo h1 {
                font-size: 1.2rem;
            }

            .login-button, .dashboard-button {
                padding: 10px 20px;
                font-size: 0.9rem;
            }

            .header-buttons {
                gap: 10px;
            }

            .cta-title {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
<!-- Fondo de partículas -->
<div id="particles-js"></div>

<!-- Header fijo -->
<header class="welcome-header">
    <div class="welcome-logo">
        <img src="images/sparky_logo.png" alt="Sparky">
        <h1>Sparky Trivia</h1>
    </div>
    <div class="header-buttons" id="headerButtons">
        <!-- Los botones se cargarán dinámicamente -->
    </div>
</header>

<!-- Hero Section -->
<section class="hero-section">
    <div class="hero-content" data-aos="fade-up">
        <h1 class="hero-title">¡Bienvenido a Sparky Trivia!</h1>
        <p class="hero-subtitle">
            La plataforma definitiva para crear, compartir y jugar trivias en tiempo real
        </p>

        <img src="images/sparky_feliz.png" alt="Sparky" class="sparky-hero" data-aos="zoom-in" data-aos-delay="200">

        <button class="cta-button" id="mainCTA" data-aos="fade-up" data-aos-delay="400">
            <!-- El texto se cargará dinámicamente -->
        </button>
    </div>
</section>

<!-- Features Section -->
<section class="features-section">
    <div class="features-grid">
        <div class="feature-card" data-aos="fade-up" data-aos-delay="100">
            <div class="feature-icon">
                <i class="bi bi-pencil-square"></i>
            </div>
            <h3 class="feature-title">Crea Trivias</h3>
            <p class="feature-description">
                Diseña tus propias trivias personalizadas con múltiples categorías y niveles de dificultad
            </p>
        </div>

        <div class="feature-card" data-aos="fade-up" data-aos-delay="200">
            <div class="feature-icon">
                <i class="bi bi-people-fill"></i>
            </div>
            <h3 class="feature-title">Juega en Tiempo Real</h3>
            <p class="feature-description">
                Compite con amigos o jugadores de todo el mundo en partidas multijugador sincronizadas
            </p>
        </div>

        <div class="feature-card" data-aos="fade-up" data-aos-delay="300">
            <div class="feature-icon">
                <i class="bi bi-trophy-fill"></i>
            </div>
            <h3 class="feature-title">Gana Puntos</h3>
            <p class="feature-description">
                Acumula puntos, sube en el ranking y desbloquea logros mientras demuestras tu conocimiento
            </p>
        </div>

        <div class="feature-card" data-aos="fade-up" data-aos-delay="400">
            <div class="feature-icon">
                <i class="bi bi-door-open-fill"></i>
            </div>
            <h3 class="feature-title">Salas Públicas y Privadas</h3>
            <p class="feature-description">
                Crea salas privadas para jugar con amigos o únete a salas públicas para nuevos desafíos
            </p>
        </div>

        <div class="feature-card" data-aos="fade-up" data-aos-delay="500">
            <div class="feature-icon">
                <i class="bi bi-collection-fill"></i>
            </div>
            <h3 class="feature-title">Variedad de Categorías</h3>
            <p class="feature-description">
                Desde historia y ciencia hasta entretenimiento y deportes, encuentra trivias para todos los gustos
            </p>
        </div>

        <div class="feature-card" data-aos="fade-up" data-aos-delay="600">
            <div class="feature-icon">
                <i class="bi bi-graph-up-arrow"></i>
            </div>
            <h3 class="feature-title">Estadísticas Detalladas</h3>
            <p class="feature-description">
                Consulta tu historial de partidas, estadísticas de rendimiento y progreso a lo largo del tiempo
            </p>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="cta-section">
    <div class="cta-content" data-aos="fade-up">
        <h2 class="cta-title">¿Listo para el desafío?</h2>
        <p class="cta-description">
            Únete a miles de jugadores que ya están disfrutando de Sparky Trivia.
            Crea tu cuenta gratis y comienza a jugar hoy mismo.
        </p>
        <button class="cta-button" onclick="redirectToRegister()">
            Crear Cuenta Gratis <i class="bi bi-person-plus-fill"></i>
        </button>
    </div>
</section>

<!-- Footer -->
<footer class="footer">
    <p class="footer-text">
        © 2025 Sparky Trivia. Desarrollado por Renata Carolina Castro Olmos e Isaías de Jesús Aviles Rodríguez
    </p>
    <p class="footer-text">
        <i class="bi bi-twitter"></i> @Sparky_Trivia
    </p>
</footer>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script src="js/particles-config.js"></script>
<script src="js/auth.js"></script>

<script>
    // Inicializar animaciones
    AOS.init({
        duration: 800,
        once: true,
        offset: 100
    });

    // CRÍTICO: Verificar sesión con el servidor, no solo con localStorage
    document.addEventListener('DOMContentLoaded', async function() {
        console.log('Welcome.html cargado - Verificando sesión real...');

        const headerButtons = document.getElementById('headerButtons');
        const mainCTA = document.getElementById('mainCTA');

        // Verificar si hay datos en localStorage
        const hayDatosLocales = haySesionActiva();

        if (hayDatosLocales) {
            console.log('Datos encontrados en localStorage - Verificando con servidor...');

            // Verificar sesión con el servidor
            const sesionValida = await verificarSesionConServidor();

            if (sesionValida) {
                const usuario = obtenerUsuario();
                console.log('✓ Sesión válida en servidor:', usuario.nickName);

                // Mostrar botón para ir al dashboard
                headerButtons.innerHTML = `
                        <button class="dashboard-button" onclick="redirectToDashboard()">
                            <i class="bi bi-speedometer2"></i> Ir al Dashboard
                        </button>
                    `;

                mainCTA.innerHTML = `
                        Ir al Dashboard <i class="bi bi-arrow-right"></i>
                    `;
                mainCTA.onclick = redirectToDashboard;

            } else {
                console.log('✗ Sesión expirada en servidor - Limpiando localStorage');

                // Limpiar localStorage porque la sesión del servidor expiró
                limpiarSesion();

                // Mostrar botón de iniciar sesión
                mostrarBotonLogin(headerButtons, mainCTA);
            }

        } else {
            console.log('No hay datos en localStorage');
            mostrarBotonLogin(headerButtons, mainCTA);
        }
    });

    // Función para verificar sesión con el servidor
    async function verificarSesionConServidor() {
        try {
            // Intentar obtener datos del usuario desde el servidor
            const response = await fetch('/SparkyTrivia/api/auth/session-check', {
                method: 'GET',
                credentials: 'include'
            });

            if (response.ok) {
                const data = await response.json();
                return data.valid === true;
            }

            return false;
        } catch (error) {
            console.error('Error verificando sesión:', error);
            return false;
        }
    }

    // Función para mostrar botón de login
    function mostrarBotonLogin(headerButtons, mainCTA) {
        headerButtons.innerHTML = `
                <button class="login-button" onclick="redirectToLogin()">
                    <i class="bi bi-box-arrow-in-right"></i> Iniciar Sesión
                </button>
            `;

        mainCTA.innerHTML = `
                Comenzar Ahora <i class="bi bi-arrow-right"></i>
            `;
        mainCTA.onclick = redirectToLogin;
    }

    // Funciones de navegación
    function redirectToLogin() {
        window.location.href = 'login.html';
    }

    function redirectToRegister() {
        window.location.href = 'register.html';
    }

    function redirectToDashboard() {
        window.location.href = 'dashboard.html';
    }
</script>
</body>
</html>