<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="sparky_logo.png">
    <title>Unirse a Sala - Sparky Trivia</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">

    <style>
        .unirse-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }

        .unirse-card {
            max-width: 500px;
            width: 100%;
        }

        .codigo-input {
            font-size: 2rem;
            text-align: center;
            letter-spacing: 8px;
            font-weight: 700;
            text-transform: uppercase;
            padding: 20px;
        }

        .codigo-display {
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            letter-spacing: 10px;
            color: var(--color-azul-claro);
            margin: 20px 0;
        }
    </style>
</head>
<body>
<div id="particles-js"></div>

<header class="header">
    <div class="header-content">
        <div class="logo" onclick="window.location.href='dashboard.html'">
            <img src="images/sparky_logo.png" alt="Sparky">
            <h1>Sparky Trivia</h1>
        </div>
    </div>
</header>

<div class="unirse-container">
    <div class="unirse-card card" data-aos="fade-up">
        <a href="dashboard.html" class="back-link">
            <i class="bi bi-arrow-left-circle"></i> Volver al Dashboard
        </a>

        <div class="sparky-container" data-aos="zoom-in">
            <img src="images/sparky_pensando.png" alt="Sparky" id="sparky">
        </div>

        <h2 class="card-title text-gradient">Unirse a Sala</h2>
        <p class="text-center text-muted mb-4">Ingresa el código de 6 caracteres</p>

        <div id="alertContainer"></div>

        <form id="unirseForm">
            <div class="form-group">
                <input
                        type="text"
                        class="form-input codigo-input"
                        id="codigoSala"
                        placeholder="XY34AB"
                        maxlength="6"
                        required
                        autocomplete="off"
                >
            </div>

            <button type="submit" class="btn btn-azul btn-ripple" id="btnUnirse" style="width: 100%;">
                <i class="bi bi-arrow-right-circle-fill me-2"></i>Unirse a Sala
            </button>
        </form>
    </div>
</div>

<footer class="footer">
    <p>&copy; 2025 Sparky Trivia | Renata Castro & Isaías Avilés</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script src="js/animations.js"></script>
<script src="js/auth.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        protegerPagina('login.html');

        AOS.init({ duration: 800, once: true });

        if (typeof particlesJS !== 'undefined') {
            particlesJS('particles-js', {
                particles: {
                    number: { value: 80 },
                    color: { value: '#ffffff' },
                    opacity: { value: 0.5 },
                    size: { value: 3 },
                    move: { enable: true, speed: 2 }
                }
            });
        }

        const form = document.getElementById('unirseForm');
        const codigoInput = document.getElementById('codigoSala');
        const btn = document.getElementById('btnUnirse');

        // Convertir a mayúsculas automáticamente
        codigoInput.addEventListener('input', function() {
            this.value = this.value.toUpperCase();
        });

        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            const codigo = codigoInput.value.trim();

            if (codigo.length !== 6) {
                mostrarAlerta('El código debe tener 6 caracteres', 'danger');
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Uniéndose...';

            try {
                const response = await postRequest('/SparkyTrivia/api/salas/unirse', {
                    codigoSala: codigo
                });

                if (response.success) {
                    mostrarAlerta('¡Te uniste exitosamente!', 'success');

                    if (typeof SparkyAnimations !== 'undefined') {
                        SparkyAnimations.sparkyHappy(document.getElementById('sparky'));
                        SparkyAnimations.confetti();
                    }

                    setTimeout(() => {
                        window.location.href = `lobby-sala.html?codigo=${codigo}`;
                    }, 1500);
                } else {
                    throw new Error(response.message || 'Error al unirse');
                }
            } catch (error) {
                console.error('Error:', error);
                mostrarAlerta(error.message || 'Error de conexión', 'danger');

                if (typeof SparkyAnimations !== 'undefined') {
                    SparkyAnimations.sparkySad(document.getElementById('sparky'));
                }

                btn.disabled = false;
                btn.innerHTML = '<i class="bi bi-arrow-right-circle-fill me-2"></i>Unirse a Sala';
            }
        });
    });
</script>
</body>
</html>