<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="sparky_logo.png">

    <title>Login - Sparky Trivia</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">

    <style>
        .login-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .login-card { max-width: 450px; width: 100%; animation: fadeInDown 0.6s ease; }

        /* SOLUCI√ìN: Estructura del input con icono */
        .form-group { position: relative; margin-bottom: 25px; }
        .form-group .form-input { width: 100%; padding: 15px 20px 15px 50px; z-index: 1; position: relative; }
        .form-group .icon-decorator { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: var(--color-gris); font-size: 1.1rem; pointer-events: none; z-index: 2; transition: color 0.3s; }
        .form-group .form-input:focus + .icon-decorator { color: var(--color-azul-claro); }

        .forgot-password { color: var(--color-azul-claro); text-decoration: none; font-size: 0.9rem; }
        .register-section { text-align: center; margin-top: 25px; padding-top: 25px; border-top: 1px solid rgba(0,0,0,0.1); }
        .register-section a { color: var(--color-azul-claro); font-weight: 600; text-decoration: none; }
    </style>
</head>
<body>
<div id="particles-js"></div>

<header class="header">
    <div class="header-content">
        <div class="logo" onclick="window.location.href='index.html'">
            <img src="images/sparky_logo.png" alt="Sparky">
            <h1>Sparky Trivia</h1>
        </div>
    </div>
</header>

<div class="login-container">
    <div class="login-card card card-tilt" data-aos="fade-up">
        <div class="sparky-container" data-aos="zoom-in">
            <img src="images/sparky_login.png?v=3" alt="Sparky" id="sparky">
        </div>

        <h2 class="card-title text-gradient">Iniciar Sesi√≥n</h2>
        <div id="alertContainer"></div>

        <form id="loginForm">
            <div class="form-group">
                <label for="email" class="form-label"><i class="bi bi-envelope-fill"></i> Email</label>
                <input type="email" class="form-input" id="email" placeholder="tucorreo@ejemplo.com" required>
                <i class="bi bi-envelope icon-decorator"></i>
                <span class="error-message d-none" id="emailError"></span>
            </div>

            <div class="form-group">
                <label for="password" class="form-label"><i class="bi bi-lock-fill"></i> Contrase√±a</label>
                <input type="password" class="form-input" id="password" placeholder="Tu contrase√±a" required>
                <i class="bi bi-lock icon-decorator"></i>
                <span class="error-message d-none" id="passwordError"></span>
            </div>

            <div class="text-end mb-3">
                <a href="#" class="forgot-password" onclick="alert('En desarrollo'); return false;">¬øOlvidaste tu contrase√±a?</a>
            </div>

            <button type="submit" class="btn btn-azul btn-ripple" id="btnLogin">
                <i class="bi bi-box-arrow-in-right me-2"></i>Iniciar Sesi√≥n
            </button>
        </form>

        <div class="register-section">
            <p>¬øNo tienes cuenta? <a href="registro.html">¬°Reg√≠strate aqu√≠!</a></p>
        </div>
    </div>
</div>

<footer class="footer">
    <p>&copy; 2025 Sparky Trivia | Renata Castro & Isa√≠as Avil√©s</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanilla-tilt@1.8.0/dist/vanilla-tilt.min.js"></script>
<script src="js/animations.js"></script>
<script src="js/auth.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        verificarSesionExistente('dashboard.html');

        const form = document.getElementById('loginForm');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const btn = document.getElementById('btnLogin');
        const sparky = document.getElementById('sparky');

        emailInput.addEventListener('blur', function() {
            const email = this.value.trim();
            if (email && !validarEmail(email)) {
                mostrarError(document.getElementById('emailError'), 'Email inv√°lido');
                this.classList.add('error');
            } else {
                ocultarError(document.getElementById('emailError'));
                this.classList.remove('error');
            }
        });

        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            const email = emailInput.value.trim();
            const password = passwordInput.value;
            let errors = false;

            if (!validarEmail(email)) {
                mostrarError(document.getElementById('emailError'), 'Email inv√°lido');
                emailInput.classList.add('error');
                errors = true;
            }

            if (!password) {
                mostrarError(document.getElementById('passwordError'), 'Contrase√±a requerida');
                passwordInput.classList.add('error');
                errors = true;
            }

            if (errors) {
                SparkyAnimations.sparkySad(sparky);
                return;
            }

            btn.disabled = true;
            btn.textContent = 'Iniciando...';

            try {
                const response = await postRequest('/SparkyTrivia/api/auth/login', { email, password });

                if (response.success) {
                    guardarUsuario(response.usuario);
                    mostrarAlerta('¬°Bienvenido, ' + response.usuario.nickName + '! üéâ', 'success');
                    SparkyAnimations.sparkyHappy(sparky);
                    SparkyAnimations.confetti();
                    setTimeout(() => window.location.href = 'dashboard.html', 1500);
                } else {
                    mostrarAlerta(response.message || 'Error al iniciar sesi√≥n', 'error');
                    SparkyAnimations.sparkySad(sparky);
                    btn.disabled = false;
                    btn.innerHTML = '<i class="bi bi-box-arrow-in-right me-2"></i>Iniciar Sesi√≥n';
                }
            } catch (error) {
                mostrarAlerta('Error de conexi√≥n', 'error');
                btn.disabled = false;
                btn.innerHTML = '<i class="bi bi-box-arrow-in-right me-2"></i>Iniciar Sesi√≥n';
            }
        });
    });
</script>
</body>
</html>